<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
<title>三年生の漢字 フラッシュカード</title>

<link href="https://fonts.googleapis.com/css2?family=BIZ+UDMincho:wght@400;700&family=BIZ+UDPGothic:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f7fafc; --ink:#1f2937; --muted:#6b7280; --card:#ffffff;
    --accent:#2563eb; --accent-ink:#ffffff;
    --chip:#e5e7eb; --chip-on:#dbeafe; --chip-ring:#93c5fd;
    --radius:22px; --shadow:0 10px 30px rgba(0,0,0,.08);
    --ui-font-stack: "BIZ UDPGothic","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    --kyokasho-stack:
      "UD Digi Kyokasho N-R","UD Digi Kyokasho N-B","UD デジタル 教科書体 N-R","UD デジタル 教科書体 N-B",
      "Yu Kyokasho","YuKyokasho","YuKyokasho Yoko","Hiragino KyoKashotai W3","Hiragino KyoKashotai W6",
      "BIZ UDMincho","Noto Serif JP","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic","Meiryo",sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: var(--ui-font-stack);
    display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .app{width:min(980px,96vw)}
  .panel{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:18px; display:flex; flex-direction:column; gap:14px;
  }
  .top{ display:flex; align-items:center; justify-content:center; gap:10px; }
  .btn{
    appearance:none; border:none; border-radius:14px; padding:12px 18px; font-size:16px; line-height:1; cursor:pointer;
    background:var(--chip); color:var(--ink);
    transition:background .15s ease, color .15s ease, transform .04s ease;
    font-family: var(--ui-font-stack);
  }
  .btn:active{ transform:translateY(1px) }
  .btn.primary{ background:var(--accent); color:var(--accent-ink); }
  .btn.switch.active{ background:var(--accent); color:var(--accent-ink); }
  .btn:disabled{ opacity:.5; cursor:not-allowed }
  .sep{ flex:1 }

  .sheet{ position:fixed; inset:0; background:rgba(0,0,0,.28); display:none; align-items:flex-end; justify-content:center; }
  .sheet.show{ display:flex }
  .sheet-inner{
    width:min(980px,100%); max-height:80vh; overflow:auto;
    background:var(--card); border-radius:20px 20px 0 0; box-shadow:var(--shadow);
    padding:16px 16px 18px; display:flex; flex-direction:column; gap:12px;
  }
  .sheet-head{ display:flex; align-items:center; }
  .sheet-title{ font-weight:700; }
  .sheet-close{ margin-left:auto; background:transparent; border:none; font-size:16px; color:var(--muted); cursor:pointer; }
  .grid{ display:grid; gap:8px; grid-template-columns: repeat(10, 1fr); }
  @media (max-width:640px){ .grid{ grid-template-columns: repeat(8, 1fr); } }
  .chip{
    background:var(--chip); border:none; border-radius:12px; padding:10px 0; cursor:pointer; font-size:18px;
    font-family: var(--kyokasho-stack);
  }
  .chip.on{ background:var(--chip-on); outline:3px solid var(--chip-ring); }
  .sheet-foot{ display:flex; gap:10px; margin-top:6px; }
  .ghost{ background:transparent; border:1px solid #cbd5e1 }

  .card-wrap{ display:none; flex-direction:column; gap:10px; }
  .backlink{ background:transparent; border:none; color:var(--muted); align-self:flex-start; cursor:pointer; padding:6px 6px; }
  .card{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding: clamp(14px, 6vw, 28px);
    display:flex; align-items:center; justify-content:center; gap: clamp(18px, 6vw, 48px);
    min-height: 48vh;
    user-select:none;
  }
  .kanji{
    font-family: var(--kyokasho-stack);
    font-size: clamp(80px, 22vw, 220px);
    line-height:1; letter-spacing: .02em;
    font-feature-settings: "palt" 1;
  }
  .answer{
    min-width: 32%;
    font-size: clamp(22px, 7vw, 42px);
    color: var(--muted);
    visibility: hidden;
    font-family: var(--ui-font-stack);
  }
  .answer.show{ visibility: visible; color: var(--ink); }
  .controls{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:center; }

  .finish{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.12); z-index:50;
  }
  .finish.show{ display:flex; animation: fade 1200ms ease; }
  .finish .box{
    background: var(--card); padding: 18px 22px; border-radius: 16px; box-shadow: var(--shadow);
    font-weight:700; font-size: 20px; font-family: var(--ui-font-stack);
  }

  /* 送り仮名の色 */
  .okuri{ color:#e11d48; font-weight:700; }
  @keyframes fade{ 0%{opacity:0} 15%{opacity:1} 85%{opacity:1} 100%{opacity:0} }
</style>
</head>
<body>
  <div class="app">
    <div class="panel" id="setup">
      <div class="top" aria-hidden="true" style="justify-content:center; font-weight:700;">三年生の漢字 フラッシュカード</div>
      <div class="controls" style="justify-content:center;">
        <button class="btn switch" id="allBtn" aria-label="ぜんぶ">ぜんぶ</button>
        <button class="btn switch" id="pickBtn" aria-label="えらぶ">えらぶ</button>
        <button class="btn switch" id="randomBtn" aria-label="ランダム20問">ランダム20問</button>
        <span class="sep"></span>
        <button class="btn primary" id="startBtn">スタート</button>
      </div>
    </div>

    <div class="card-wrap" id="play">
      <button class="backlink" id="backBtn">← もどる</button>
      <div class="card" id="card" role="button" aria-label="カードをタップ">
        <div class="kanji" id="q"></div>
        <div class="answer" id="a"></div>
      </div>
    </div>
  </div>

  <div class="sheet" id="sheet" aria-modal="true" role="dialog">
    <div class="sheet-inner">
      <div class="sheet-head">
        <div class="sheet-title">漢字をえらぶ</div>
        <button class="sheet-close" id="closeSheet">とじる ✕</button>
      </div>
      <div class="grid" id="grid"></div>
      <div class="sheet-foot">
        <button class="btn ghost" id="clearBtn">全解除</button>
        <span class="sep"></span>
        <button class="btn primary" id="okBtn">OK</button>
      </div>
    </div>
  </div>

  <div class="finish" id="finish">
    <div class="box">がんばったね😊</div>
  </div>

<script>
/* ---------- 表示ユーティリティ（送り仮名を赤に） ---------- */
function formatReading(text){
  if(!text) return "";
  return text
    .split("・")
    .map(t => t.replace(/\(([^)]+)\)/g, '<span class="okuri">$1</span>'))
    .join("・");
}

/* ---------- データ ---------- */
// 小学三年生（200字）
const KANJI_LIST = [
  "丁","世","両","主","乗","予","事","仕","他","代","住","使","係","倍","全","具","写","列","助","勉",
  "動","勝","化","区","医","去","反","取","受","号","向","君","味","命","和","品","員","商","問","坂",
  "央","始","委","守","安","定","実","客","宮","宿","寒","対","局","屋","岸","島","州","帳","平","幸",
  "度","庫","庭","式","役","待","急","息","悪","悲","想","意","感","所","打","投","拾","持","指","放",
  "整","旅","族","昔","昭","暑","暗","曲","有","服","期","板","柱","根","植","業","様","横","橋","次",
  "歯","死","氷","決","油","波","注","泳","洋","流","消","深","温","港","湖","湯","漢","炭","物",
  "球","由","申","界","畑","病","発","登","皮","皿","相","県","真","着","短","研","礼","神","祭","福",
  "秒","究","章","童","笛","第","筆","等","箱","級","終","緑","練","羊","美","習","者","育","苦","荷",
  "落","葉","薬","血","表","詩","調","談","豆","負","起","路","身","転","軽","農","返","追","送","速",
  "進","遊","運","部","都","配","酒","重","鉄","銀","開","院","陽","階","集","面","題","飲","館","駅","鼻"
];

// 読み（()内＝送り仮名を赤表示）
const READINGS = {
  "丁":"ちょう・てい",
  "世":"よ・せ・せい",
  "両":"りょう",
  "主":"ぬし・おも(な)・しゅ",
  "乗":"の(る)・じょう",
  "予":"よ",
  "事":"こと・じ",
  "仕":"つか(える)・し",
  "他":"ほか・た",
  "代":"か(わる)・だい・よ",
  "住":"す(む)・じゅう",
  "使":"つか(う)・し",
  "係":"かか(り)・けい",
  "倍":"ばい",
  "全":"ぜん",
  "具":"そな(える)・ぐ",
  "写":"うつ(す)・しゃ",
  "列":"れつ",
  "助":"たす(ける)・じょ",
  "勉":"べん",
  "動":"うご(く)・どう",
  "勝":"か(つ)・しょう",
  "化":"ば(ける)・か",
  "区":"く",
  "医":"い",
  "去":"さ(る)・きょ",
  "反":"はん・そ(る)",
  "取":"と(る)",
  "受":"う(ける)",
  "号":"ごう",
  "向":"む(く)・む(ける)・こう",
  "君":"きみ・くん",
  "味":"あじ・み",
  "命":"いのち・めい",
  "和":"わ・なご（む）",
  "品":"しな・ひん",
  "員":"いん",
  "商":"しょう",
  "問":"と(う)・もん",
  "坂":"さか・はん",
  "央":"おう",
  "始":"はじ(める)・し",
  "委":"い",
  "守":"まも(る)・しゅ",
  "安":"やす(い)・あん",
  "定":"さだ(める)・てい",
  "実":"み・じつ",
  "客":"きゃく",
  "宮":"みや・きゅう",
  "宿":"やど・しゅく",
  "寒":"さむ(い)・かん",
  "対":"たい",
  "局":"きょく",
  "屋":"や・おく",
  "岸":"きし・がん",
  "島":"しま・とう",
  "州":"す・しゅう",
  "帳":"ちょう",
  "平":"たい(ら)・へい",
  "幸":"しあわ(せ)・こう",
  "度":"ど",
  "庫":"こ",
  "庭":"にわ・てい",
  "式":"しき",
  "役":"やく",
  "待":"ま(つ)・たい",
  "急":"いそ(ぐ)・きゅう",
  "息":"いき・そく",
  "悪":"わる(い)・あく",
  "悲":"かな(しい)・ひ",
  "想":"そう",
  "意":"い",
  "感":"かん",
  "所":"ところ・しょ",
  "打":"う(つ)・だ",
  "投":"な(げる)・とう",
  "拾":"ひろ(う)・しゅう",
  "持":"も(つ)・じ",
  "指":"ゆび・さ(す)・し",
  "放":"はな(す)・ほう",
  "整":"ととの(える)・せい",
  "旅":"たび・りょ",
  "族":"ぞく",
  "昔":"むかし",
  "昭":"しょう",
  "暑":"あつ(い)・しょ",
  "暗":"くら(い)・あん",
  "曲":"ま(がる)・きょく",
  "有":"あ(る)・ゆう",
  "服":"ふく",
  "期":"き",
  "板":"いた・はん",
  "柱":"はしら・ちゅう",
  "根":"ね・こん",
  "植":"う(える)・しょく",
  "業":"ぎょう",
  "様":"さま・よう",
  "横":"よこ・おう",
  "橋":"はし・きょう",
  "次":"つぎ・じ",
  "歯":"は・し",
  "死":"し",
  "氷":"こおり・ひょう",
  "決":"き(める)・けつ",
  "油":"あぶら・ゆ",
  "波":"なみ・は",
  "注":"そそ(ぐ)・ちゅう",
  "泳":"およ(ぐ)・えい",
  "洋":"よう",
  "流":"なが(れる)・りゅう",
  "消":"き(える)・け(す)・しょう",
  "深":"ふか(い)・しん",
  "温":"あたた(かい)・おん",
  "港":"みなと・こう",
  "湖":"みずうみ・こ",
  "湯":"ゆ・とう",
  "漢":"かん",
  "炭":"すみ・たん",
  "物":"もの・ぶつ",
  "球":"たま・きゅう",
  "由":"よし・ゆ",
  "申":"もう(す)・しん",
  "界":"かい",
  "畑":"はたけ",
  "病":"やまい・びょう",
  "発":"はつ",
  "登":"のぼ(る)・とう",
  "皮":"かわ・ひ",
  "皿":"さら",
  "相":"あい・そう",
  "県":"けん",
  "真":"ま・しん",
  "着":"き(る)・つ(く)・ちゃく",
  "短":"みじか(い)・たん",
  "研":"と(ぐ)・けん",
  "礼":"れい",
  "神":"かみ・しん",
  "祭":"まつ(り)・さい",
  "福":"ふく",
  "秒":"びょう",
  "究":"きわ(める)・きゅう",
  "章":"しょう",
  "童":"わらべ・どう",
  "笛":"ふえ・てき",
  "第":"だい",
  "筆":"ふで・ひつ",
  "等":"とう",
  "箱":"はこ",
  "級":"きゅう",
  "終":"お(わる)・しゅう",
  "緑":"みどり・りょく",
  "練":"ね(る)・れん",
  "羊":"ひつじ・よう",
  "美":"うつく(しい)・び",
  "習":"なら(う)・しゅう",
  "者":"もの・しゃ",
  "育":"そだ(つ)・いく",
  "苦":"にが(い)・くる(しい)・く",
  "荷":"に・か",
  "落":"お(ちる)・らく",
  "葉":"は・よう",
  "薬":"くすり・やく",
  "血":"ち・けつ",
  "表":"おもて・あらわ(す)・ひょう",
  "詩":"し",
  "調":"しら(べる)・ちょう",
  "談":"だん",
  "豆":"まめ・とう",
  "負":"ま(ける)・お(う)・ふ",
  "起":"お(きる)・き",
  "路":"ろ",
  "身":"み・しん",
  "転":"ころ(ぶ)・てん",
  "軽":"かる(い)・けい",
  "農":"のう",
  "返":"かえ(す)・へん",
  "追":"お(う)・つい",
  "送":"おく(る)・そう",
  "速":"はや(い)・そく",
  "進":"すす(む)・しん",
  "遊":"あそ(ぶ)・ゆう",
  "運":"はこ(ぶ)・うん",
  "部":"ぶ",
  "都":"みやこ・と",
  "配":"くば(る)・はい",
  "酒":"さけ・しゅ",
  "重":"おも(い)・じゅう",
  "鉄":"てつ",
  "銀":"ぎん",
  "開":"ひら(く)・あ(く)・かい",
  "院":"いん",
  "陽":"ひ・よう",
  "階":"かい",
  "集":"あつ(まる)・しゅう",
  "面":"おも・めん",
  "題":"だい",
  "飲":"の(む)・いん",
  "館":"やかた・かん",
  "駅":"えき",
  "鼻":"はな・び"
};

/* ---------- 状態 ---------- */
let picked = [];
let order = [];
let idx = 0;
let showAns = false;
let mode = null;

/* ---------- 要素参照 ---------- */
const setup = document.getElementById('setup');
const play = document.getElementById('play');
const qEl = document.getElementById('q');
const aEl = document.getElementById('a');
const card = document.getElementById('card');

const allBtn = document.getElementById('allBtn');
const pickBtn = document.getElementById('pickBtn');
const randomBtn = document.getElementById('randomBtn');
const startBtn = document.getElementById('startBtn');
const backBtn = document.getElementById('backBtn');

const sheet = document.getElementById('sheet');
const grid = document.getElementById('grid');
const okBtn = document.getElementById('okBtn');
const clearBtn = document.getElementById('clearBtn');
const closeSheet = document.getElementById('closeSheet');

const finish = document.getElementById('finish');

/* ---------- 初期化 ---------- */
updateStartEnable();
setActiveButtons();

/* ---------- ハンドラ ---------- */
allBtn.addEventListener('click', ()=>{
  picked = [...KANJI_LIST];
  mode = 'all'; setActiveButtons(); flashPickToast(); updateStartEnable();
});
pickBtn.addEventListener('click', ()=>{
  mode = 'pick'; setActiveButtons(); openPicker();
});
randomBtn.addEventListener('click', ()=>{
  picked = sampleUnique(KANJI_LIST, 20);
  mode = 'random20'; setActiveButtons(); flashPickToast(); updateStartEnable();
});
startBtn.addEventListener('click', ()=>{
  if(picked.length===0){ picked = [...KANJI_LIST]; mode='all'; setActiveButtons(); }
  begin();
});
backBtn.addEventListener('click', ()=>{ endAndReturn(); });

/* カード操作 */
card.addEventListener('click', nextOrReveal);

/* 矢印キー（→で答え→次へ、←で戻る） */
window.addEventListener('keydown', (e)=>{
  if (!isPlaying()) return;
  if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') e.preventDefault();
  if (e.key === 'ArrowRight') nextOrReveal();
  if (e.key === 'ArrowLeft') prevOne();
});

/* ---------- ピッカー ---------- */
function openPicker(){
  if(!grid.dataset.ready){
    const frag = document.createDocumentFragment();
    KANJI_LIST.forEach(k=>{
      const b = document.createElement('button');
      b.className = 'chip'; b.textContent = k; b.type='button';
      b.addEventListener('click', ()=> b.classList.toggle('on'));
      frag.appendChild(b);
    });
    grid.appendChild(frag); grid.dataset.ready = '1';
  }
  Array.from(grid.children).forEach(chip=> chip.classList.remove('on'));
  sheet.classList.add('show'); document.body.style.overflow='hidden';
}
closeSheet.addEventListener('click', closePicker);
okBtn.addEventListener('click', ()=>{
  picked = Array.from(grid.children).filter(el=>el.classList.contains('on')).map(el=>el.textContent);
  updateStartEnable(); closePicker();
});
clearBtn.addEventListener('click', ()=>{ Array.from(grid.children).forEach(el=>el.classList.remove('on')); });
function closePicker(){ sheet.classList.remove('show'); document.body.style.overflow=''; }

/* ---------- ゲームフロー ---------- */
function begin(){
  order = picked.map(k => KANJI_LIST.indexOf(k)).filter(i=>i>=0);
  if(mode === 'random20'){ shuffle(order); }
  idx = 0; setup.style.display = 'none'; play.style.display = 'flex'; showQuestion();
}
function showQuestion(){
  const k = KANJI_LIST[order[idx]];
  qEl.textContent = k;
  aEl.innerHTML  = formatReading(READINGS[k] || "（よみ未設定）");
  showAns = false; aEl.classList.remove('show');
}
function nextOrReveal(){
  if(!showAns){ showAns = true; aEl.classList.add('show'); return; }
  if(idx + 1 >= order.length){ finishRound(); }
  else{ idx++; showQuestion(); }
}
function prevOne(){
  if(idx === 0) return;
  idx--; showQuestion();
}
function finishRound(){
  finish.classList.add('show');
  setTimeout(()=>{ finish.classList.remove('show'); endAndReturn(); }, 1200);
}
function endAndReturn(){
  play.style.display = 'none'; setup.style.display = '';
  idx = 0; showAns = false; aEl.classList.remove('show');
  mode = null; setActiveButtons();
}

/* ---------- ヘルパー ---------- */
function setActiveButtons(){
  allBtn.classList.toggle('active', mode==='all');
  pickBtn.classList.toggle('active', mode==='pick');
  randomBtn.classList.toggle('active', mode==='random20');
}
function flashPickToast(){
  (mode==='random20' ? randomBtn : allBtn).animate(
    [{transform:'scale(1)'},{transform:'scale(1.05)'},{transform:'scale(1)'}],
    {duration:220}
  );
}
function updateStartEnable(){ startBtn.disabled = false; }
function isPlaying(){ return play.style.display === 'flex'; }
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}
function sampleUnique(source, n){
  const copy = [...source];
  shuffle(copy);
  return copy.slice(0, Math.min(n, copy.length));
}
</script>
</body>
</html>
